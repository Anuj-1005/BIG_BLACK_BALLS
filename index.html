<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Quiz Game - Player</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 600px;
      margin: 40px auto;
      padding: 30px 40px;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      border-radius: 12px;
      box-shadow: 0 12px 24px rgba(0,0,0,0.15);
      color: #333;
      box-sizing: border-box;
    }

    h2 {
      text-align: center;
      color: #2c3e50;
      margin-bottom: 30px;
      letter-spacing: 1.2px;
      font-weight: 700;
      font-size: 2rem;
    }

    #playerInfo {
      font-size: 1.1rem;
      text-align: center;
      margin-bottom: 25px;
      font-weight: 600;
      color: #34495e;
    }

    #statusDiv {
      margin-bottom: 20px;
      font-weight: 700;
      font-size: 1.25rem;
      text-align: center;
      color: #2980b9;
      text-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }

    #questionDiv {
      font-size: 1.35rem;
      margin-bottom: 25px;
      padding: 15px 20px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 6px 12px rgba(0,0,0,0.07);
      line-height: 1.4;
      font-weight: 600;
    }

    button.option-btn {
      margin: 8px 8px 8px 0;
      padding: 14px 28px;
      font-size: 1.1rem;
      cursor: pointer;
      border-radius: 10px;
      border: none;
      background-color: #007BFF;
      color: white;
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
      box-shadow: 0 5px 12px rgba(0,123,255,0.4);
      user-select: none;
      min-width: 48%;
      display: inline-block;
      text-align: center;
      touch-action: manipulation;
    }

    button.option-btn:hover:not(:disabled) {
      background-color: #0056b3;
      box-shadow: 0 8px 20px rgba(0,86,179,0.6);
    }

    button.option-btn:active:not(:disabled) {
      background-color: #003d80;
      box-shadow: 0 3px 8px rgba(0,61,128,0.7);
      transform: translateY(2px);
    }

    button.option-btn:disabled {
      background-color: #cccccc;
      cursor: default;
      box-shadow: none;
      color: #666666;
    }

    @media (max-width: 640px) {
      body {
        margin: 20px 15px;
        padding: 20px 15px;
      }

      h2 {
        font-size: 1.6rem;
        margin-bottom: 20px;
      }

      #statusDiv {
        font-size: 1.1rem;
        margin-bottom: 15px;
      }

      #questionDiv {
        font-size: 1.2rem;
        margin-bottom: 20px;
        padding: 12px 15px;
      }

      button.option-btn {
        min-width: 100%;
        margin-bottom: 12px;
        padding: 16px;
        font-size: 1.15rem;
        box-shadow: 0 6px 14px rgba(0,123,255,0.5);
      }

      button.option-btn:last-child {
        margin-bottom: 0;
      }
    }
  </style>
</head>
<body>
  <h2>Quiz Game - Player</h2>
  <div id="playerInfo"></div>
  <div id="statusDiv">Waiting for the next round...</div>
  <div id="questionDiv"></div>
  <div id="optionsDiv"></div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyB8hNeYCaCUDEb442816H7m5czjU_p7yvk",
      authDomain: "space-nut.firebaseapp.com",
      databaseURL: "https://space-nut-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "space-nut",
      storageBucket: "space-nut.firebasestorage.app",
      messagingSenderId: "361367330680",
      appId: "1:361367330680:web:4feeea30968b766b2b328d"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Reset detection: listen for players node removed (game reset)
    db.ref('players').on('value', snapshot => {
      if (!snapshot.exists()) {
        localStorage.removeItem('playerUID');
        localStorage.removeItem('playerColor');

        alert("Game has been reset by admin. You will need to enter your name and color again.");
        location.reload();
      }
    });

    // Prompt for player details if not stored or invalid
    function promptForPlayerDetails() {
      let uid = localStorage.getItem('playerUID');
      let color = localStorage.getItem('playerColor');
      const validColors = ['Saffron', 'Green', 'White', 'Blue', 'Red', 'Yellow'];

      while (!uid || !/^[a-zA-Z]+$/.test(uid)) {
        uid = prompt("Enter your player UID (alphabets only)").trim();
      }
      while (!color || !validColors.includes(color)) {
        color = prompt("Enter your color (Saffron, Green, White, Blue, Red, Yellow)").trim();
      }

      localStorage.setItem('playerUID', uid);
      localStorage.setItem('playerColor', color);
      return { uid, color };
    }

    // Initial load or reload
    const playerDetails = promptForPlayerDetails();
    const playerUID = playerDetails.uid;
    const playerColor = playerDetails.color;

    document.getElementById('playerInfo').textContent = `Player: ${playerUID} | Color: ${playerColor}`;

    // Paste your full questionsData JSON here:
    const questionsData = {
  "Saffron": [
    { "q": "Which Indian festival celebrates courage and heroism?", "options": ["Maha Shivaratri", "Holi", "Kargil Vijay Diwas"], "answerIndex": 2 },
    { "q": "Which festival marks the victory of good over evil?", "options": ["Diwali", "Onam", "Raksha Bandhan"], "answerIndex": 0 },
    { "q": "Who is the famous warrior queen of Jhansi?", "options": ["Rani Lakshmibai", "Rani Padmini", "Rani Durgavati"], "answerIndex": 0 },
    { "q": "Which festival involves the burning of effigies of Ravana?", "options": ["Dussehra", "Holi", "Diwali"], "answerIndex": 0 },
    { "q": "Which festival celebrates the birth of Lord Krishna?", "options": ["Janmashtami", "Ganesh Chaturthi", "Navratri"], "answerIndex": 0 },
    { "q": "Which event commemorates India’s war victory in 1999?", "options": ["Independence Day", "Kargil Vijay Diwas", "Republic Day"], "answerIndex": 1 },
    { "q": "Which festival celebrates the victory of Lord Rama?", "options": ["Dussehra", "Diwali", "Makar Sankranti"], "answerIndex": 0 },
    { "q": "Which festival includes the display of colorful lamps and fireworks?", "options": ["Diwali", "Holi", "Onam"], "answerIndex": 0 },
    { "q": "Which festival honors martyrs and soldiers in India?", "options": ["Kargil Vijay Diwas", "Republic Day", "Lohri"], "answerIndex": 0 },
    { "q": "Who was the leader of the 1857 revolt known as the 'Indian Mutiny'?", "options": ["Rani Lakshmibai", "Bahadur Shah Zafar", "Mangal Pandey"], "answerIndex": 2 },
    { "q": "Which festival celebrates the triumph of light over darkness?", "options": ["Diwali", "Holi", "Eid"], "answerIndex": 0 },
    { "q": "Which festival is famous for its vibrant traditional dances in India?", "options": ["Navratri", "Ganesh Chaturthi", "Pongal"], "answerIndex": 0 }
  ],
  "Green": [
    { "q": "Which crop is the staple food of India?", "options": ["Rice", "Wheat", "Corn"], "answerIndex": 0 },
    { "q": "Which Indian state is famous for tea plantations?", "options": ["Assam", "Punjab", "Rajasthan"], "answerIndex": 0 },
    { "q": "What is the main source of irrigation in India?", "options": ["Monsoon rains", "Glaciers", "Desert water"], "answerIndex": 0 },
    { "q": "Which festival is celebrated to honor farmers in India?", "options": ["Makar Sankranti", "Diwali", "Eid"], "answerIndex": 0 },
    { "q": "Which tree is called the 'national tree' of India?", "options": ["Banyan", "Peepal", "Neem"], "answerIndex": 0 },
    { "q": "What type of soil is best suited for agriculture in India?", "options": ["Alluvial soil", "Sandy soil", "Rocky soil"], "answerIndex": 0 },
    { "q": "Which river basin is known as the 'Rice Bowl of India'?", "options": ["Godavari basin", "Yamuna basin", "Narmada basin"], "answerIndex": 0 },
    { "q": "Which season is critical for agriculture in India?", "options": ["Monsoon", "Summer", "Winter"], "answerIndex": 0 },
    { "q": "Which natural resource is abundant in India’s forests?", "options": ["Timber", "Oil", "Gold"], "answerIndex": 0 },
    { "q": "Which fruit is known as the 'king of fruits' in India?", "options": ["Mango", "Apple", "Banana"], "answerIndex": 0 },
    { "q": "Which crop is commonly harvested during the festival of Pongal?", "options": ["Rice", "Wheat", "Barley"], "answerIndex": 0 },
    { "q": "Which of these is a major tea-producing region in India?", "options": ["Darjeeling", "Manali", "Chennai"], "answerIndex": 0 }
  ],
  "White": [
    { "q": "Which Indian festival symbolizes peace and spirituality?", "options": ["Buddha Purnima", "Holi", "Diwali"], "answerIndex": 0 },
    { "q": "Who founded Buddhism in India?", "options": ["Gautama Buddha", "Mahavira", "Chandragupta"], "answerIndex": 0 },
    { "q": "Which festival is dedicated to Lord Shiva and involves fasting?", "options": ["Maha Shivaratri", "Diwali", "Raksha Bandhan"], "answerIndex": 0 },
    { "q": "Which spiritual practice originated in India and involves meditation?", "options": ["Yoga", "Tango", "Karate"], "answerIndex": 0 },
    { "q": "Which festival promotes harmony and brotherhood?", "options": ["Raksha Bandhan", "Holi", "Diwali"], "answerIndex": 0 },
    { "q": "Which Indian philosopher is famous for his teachings of non-violence?", "options": ["Mahatma Gandhi", "Chanakya", "Swami Vivekananda"], "answerIndex": 0 },
    { "q": "Which river is considered holy and spiritual in India?", "options": ["Ganges", "Nile", "Amazon"], "answerIndex": 0 },
    { "q": "What is the Indian system of traditional medicine?", "options": ["Ayurveda", "Homeopathy", "Allopathy"], "answerIndex": 0 },
    { "q": "Which festival celebrates the spiritual bond between brothers and sisters?", "options": ["Raksha Bandhan", "Eid", "Christmas"], "answerIndex": 0 },
    { "q": "Which meditation technique is practiced widely in India?", "options": ["Transcendental Meditation", "Zen", "Tai Chi"], "answerIndex": 0 },
    { "q": "Who is the author of the Bhagavad Gita?", "options": ["Vyasa", "Kalidasa", "Valmiki"], "answerIndex": 0 },
    { "q": "Which spiritual leader inspired India’s independence movement?", "options": ["Mahatma Gandhi", "Jawaharlal Nehru", "Subhas Chandra Bose"], "answerIndex": 0 }
  ],
  "Blue": [
    { "q": "Which is the longest river in India?", "options": ["Ganges", "Yamuna", "Godavari"], "answerIndex": 0 },
    { "q": "Which ocean borders India to the south?", "options": ["Indian Ocean", "Atlantic Ocean", "Pacific Ocean"], "answerIndex": 0 },
    { "q": "Which monsoon season brings most rainfall to India?", "options": ["Southwest Monsoon", "Northeast Monsoon", "Winter Monsoon"], "answerIndex": 0 },
    { "q": "Which river is known as the 'Sorrow of Bihar'?", "options": ["Kosi", "Ganges", "Brahmaputra"], "answerIndex": 0 },
    { "q": "Which sea lies to the west of India?", "options": ["Arabian Sea", "Bay of Bengal", "Red Sea"], "answerIndex": 0 },
    { "q": "Which river originates from the Himalayas?", "options": ["Ganges", "Krishna", "Mahanadi"], "answerIndex": 0 },
    { "q": "Which monsoon affects the eastern coast of India?", "options": ["Northeast Monsoon", "Southwest Monsoon", "Winter Monsoon"], "answerIndex": 0 },
    { "q": "Which river forms the largest delta in India?", "options": ["Ganges-Brahmaputra", "Narmada", "Godavari"], "answerIndex": 0 },
    { "q": "Which island group lies in the Bay of Bengal?", "options": ["Andaman and Nicobar Islands", "Lakshadweep Islands", "Maldives"], "answerIndex": 0 },
    { "q": "Which port city is on the Arabian Sea?", "options": ["Mumbai", "Chennai", "Kolkata"], "answerIndex": 0 },
    { "q": "Which sea borders India on the east?", "options": ["Bay of Bengal", "Arabian Sea", "Red Sea"], "answerIndex": 0 },
    { "q": "Which phenomenon causes heavy rainfall during the Indian monsoon?", "options": ["Low-pressure system", "Cyclone", "Tsunami"], "answerIndex": 0 }
  ],
  "Red": [
    { "q": "What is a common Indian wedding ceremony called?", "options": ["Saptapadi", "Diwali", "Holi"], "answerIndex": 0 },
    { "q": "Which celebration involves decorating the bride and groom with flowers?", "options": ["Mehndi", "Eid", "Christmas"], "answerIndex": 0 },
    { "q": "In which festival do people light lamps to celebrate victory of good over evil?", "options": ["Diwali", "Holi", "Eid"], "answerIndex": 0 },
    { "q": "What is the traditional attire of a bride in many Indian weddings?", "options": ["Sari", "Jeans", "T-shirt"], "answerIndex": 0 },
    { "q": "Which ritual involves applying henna to the bride’s hands and feet?", "options": ["Mehndi ceremony", "Lohri", "Raksha Bandhan"], "answerIndex": 0 },
    { "q": "Which festival marks the harvest season and is celebrated with bonfires in Punjab?", "options": ["Lohri", "Eid", "Christmas"], "answerIndex": 0 },
    { "q": "What is the name of the wedding ritual where the couple takes seven steps together?", "options": ["Saptapadi", "Raksha Bandhan", "Diwali"], "answerIndex": 0 },
    { "q": "Which celebration is known as the festival of colors?", "options": ["Holi", "Diwali", "Eid"], "answerIndex": 0 },
    { "q": "During which festival do families exchange gifts and sweets?", "options": ["Diwali", "Holi", "Lohri"], "answerIndex": 0 },
    { "q": "What is the term for the wedding procession of the groom?", "options": ["Baraat", "Mehndi", "Puja"], "answerIndex": 0 },
    { "q": "Which ceremony includes the bride’s family giving gifts to the groom’s family?", "options": ["Kanyadaan", "Raksha Bandhan", "Holi"], "answerIndex": 0 },
    { "q": "Which festival celebrates the bond between brothers and sisters?", "options": ["Raksha Bandhan", "Diwali", "Lohri"], "answerIndex": 0 }
  ],
  "Yellow": [
    { "q": "Which festival celebrates the joy of harvest in India?", "options": ["Pongal", "Diwali", "Holi"], "answerIndex": 0 },
    { "q": "Which crop is harvested during the festival of Baisakhi?", "options": ["Wheat", "Rice", "Maize"], "answerIndex": 0 },
    { "q": "Which festival is known as the ‘Festival of Harvest’ in Tamil Nadu?", "options": ["Pongal", "Onam", "Lohri"], "answerIndex": 0 },
    { "q": "Which fruit is celebrated during the festival of Annapurna?", "options": ["Rice", "Mango", "Banana"], "answerIndex": 0 },
    { "q": "Which festival thanks the Sun God for the harvest?", "options": ["Makar Sankranti", "Diwali", "Raksha Bandhan"], "answerIndex": 0 },
    { "q": "Which grain is mostly harvested during the festival of Pongal?", "options": ["Rice", "Wheat", "Barley"], "answerIndex": 0 },
    { "q": "Which festival marks the end of the harvest season in Kerala?", "options": ["Onam", "Diwali", "Holi"], "answerIndex": 0 },
    { "q": "Which festival involves decorating cattle to thank them for their help in harvest?", "options": ["Mattu Pongal", "Eid", "Raksha Bandhan"], "answerIndex": 0 },
    { "q": "Which is the main harvest festival celebrated in Punjab?", "options": ["Baisakhi", "Diwali", "Lohri"], "answerIndex": 0 },
    { "q": "Which festival includes singing and dancing to celebrate harvest?", "options": ["Lohri", "Holi", "Eid"], "answerIndex": 0 },
    { "q": "Which festival celebrates the new crop and involves food offerings?", "options": ["Makar Sankranti", "Raksha Bandhan", "Onam"], "answerIndex": 0 },
    { "q": "Which festival is celebrated with kite flying and marks harvest time?", "options": ["Makar Sankranti", "Diwali", "Eid"], "answerIndex": 0 }
  ]
};


    let usedQuestionIndices = new Set();
    let roundStartTime = 0;

    const statusDiv = document.getElementById('statusDiv');
    const questionDiv = document.getElementById('questionDiv');
    const optionsDiv = document.getElementById('optionsDiv');

    // Listen for round start
    const roundStartedRef = db.ref('gameStatus/roundStarted');
    roundStartedRef.on('value', snapshot => {
      const started = snapshot.val();
      if (started) {
        statusDiv.textContent = "Round started! Fetching your question...";
        showRandomQuestion();
      } else {
        clearQuestionUI();
        statusDiv.textContent = "Waiting for the next round...";
      }
    });

    function showRandomQuestion() {
      const questions = questionsData[playerColor];
      if (!questions) {
        questionDiv.textContent = "No questions available for your color.";
        return;
      }

      let index;
      do {
        index = Math.floor(Math.random() * questions.length);
      } while (usedQuestionIndices.has(index) && usedQuestionIndices.size < questions.length);

      usedQuestionIndices.add(index);

      const question = questions[index];

      questionDiv.textContent = question.q;
      optionsDiv.innerHTML = '';
      question.options.forEach((opt, i) => {
        const btn = document.createElement('button');
        btn.className = 'option-btn';
        btn.textContent = opt;
        btn.onclick = () => submitAnswer(index, i, question.answerIndex);
        optionsDiv.appendChild(btn);
      });

      roundStartTime = Date.now();
    }

    async function submitAnswer(questionIndex, selectedIndex, correctIndex) {
      const timeTaken = (Date.now() - roundStartTime) / 1000;

      [...optionsDiv.children].forEach(btn => btn.disabled = true);

      const isCorrect = (selectedIndex === correctIndex);

      statusDiv.textContent = isCorrect
        ? `Correct! You answered in ${timeTaken.toFixed(2)} seconds.`
        : `Wrong answer.`;

      try {
        await db.ref(`players/${playerUID}`).update({
          answered: isCorrect,
          timeTaken: isCorrect ? timeTaken : null,
          lastQuestionIndex: questionIndex,
          color: playerColor
        });

        if (isCorrect) {
          const colorCountRef = db.ref(`colorCounts/${playerColor}`);
          await colorCountRef.transaction(current => (current || 0) + 1);

          const fastestRef = db.ref('fastestAnswer');
          await fastestRef.transaction(current => {
            if (!current || timeTaken < current.time) {
              return { playerUID, color: playerColor, time: timeTaken };
            }
            return current;
          });
        }

        console.log('Answer submitted:', isCorrect, timeTaken);

      } catch (error) {
        console.error('Error submitting answer:', error);
        statusDiv.textContent = 'Error submitting your answer. Try again.';
      }
    }

    function clearQuestionUI() {
      questionDiv.textContent = '';
      optionsDiv.innerHTML = '';
    }
  </script>
</body>
</html>
